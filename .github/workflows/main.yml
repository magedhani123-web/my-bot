name: Run My Bot

on:
  workflow_dispatch: # للتشغيل اليدوي
  schedule:
    - cron: '0 */6 * * *' # تشغيل تلقائي كل 6 ساعات

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. سحب الكود من المستودع (ضروري جداً ليجد الملفات)
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. إعداد لغة بايثون
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. تثبيت المتطلبات (النظام والمكتبات)
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y tor* gdebi xvfb tor xvfb
          pip install selenium requests
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo gdebi google-chrome-stable_current_amd64.deb

      # 4. إعداد Tor وتكوين منفذ التحكم (ControlPort) كما في الكود الخاص بك
      - name: Configure and Start Tor
        run: |
          sudo bash -c 'echo -e "ControlPort 9051\nCookieAuthentication 0" >> /etc/tor/torrc'
          sudo service tor start
          sleep 5

      # 5. خطوة اختيارية للتأكد من وجود الملف (ستظهر في السجلات)
      - name: Verify file existence
        run: ls -la

      # 6. تشغيل البوت باستخدام xvfb لمحاكاة الشاشة (Headless Mode)
      - name: Start Bot
        run: |
          # نستخدم xvfb-run لتفادي أخطاء المتصفح في البيئات التي لا تملك شاشة
          xvfb-run python bot_master2.py
