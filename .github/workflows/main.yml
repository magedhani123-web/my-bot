name: Run My Bot Forever

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

permissions:
  actions: write

jobs:
  build:
    runs-on: ubuntu-latest
    # ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ø¨Ø± ØªØ¬Ø§Ù‡Ù„ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¶Ø¹ÙŠÙØ©
    env:
      PYTHONUNBUFFERED: "1"
      NODE_OPTIONS: "--max-old-space-size=4096"

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Maximize CPU Performance
        run: |
          # Ø¶Ø¨Ø· Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø© Ù…Ù…ÙƒÙ†Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
          sudo sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT="/&mitigations=off /' /etc/default/grub || true
          echo "ğŸš€ CPU Resources Optimized for Heavy Tasking"

      - name: Install Google Chrome Stable
        run: |
          sudo apt-get update
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb

      - name: Install System Dependencies
        run: |
          sudo apt-get update
          # ØªØ«Ø¨ÙŠØª Ø­Ø²Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØªÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
          sudo apt-get install -y tor xvfb libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 libxkbcommon0 libxcomposite1 libxdamage1 libxrandr2 libgbm1 libasound2t64 ffmpeg
          pip install undetected_chromedriver selenium requests

      - name: Configure and Start Tor
        run: |
          sudo service tor stop || true
          sudo bash -c 'echo -e "ControlPort 9051\nCookieAuthentication 0\nDataDirectory /var/lib/tor" > /etc/tor/torrc'
          sudo service tor start
          echo "â³ Establishing Tor Circuit..."
          sleep 20

      - name: Start Bot (High Performance Mode)
        # xvfb-run Ù…Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø´Ø§Ø´Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¯Ù‚Ø© ØªØ¶Ù…Ù† Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…ØªØµÙØ­
        run: |
          timeout 350m xvfb-run --server-args="-screen 0 1920x1080x24 -ac +extension GLX +render -noreset" python -u bot_master1.py || echo "âš ï¸ Session ended, preparing restart..."

      - name: Self-Restart Workflow
        if: always()
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "ğŸš€ Triggering self-restart: Ensuring the bot never stops!"
          gh workflow run "Run My Bot Forever"
